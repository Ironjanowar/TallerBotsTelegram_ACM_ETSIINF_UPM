<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8"/>
<title>Telegram Bots</title>
<meta name="author" content="(@CesharPaste)"/>
<style type="text/css">
.underline { text-decoration: underline; }
</style>
<link rel="stylesheet" href="file:///home/ironjanowar/reveal.js/css/reveal.css"/>

<link rel="stylesheet" href="file:///home/ironjanowar/reveal.js/css/theme/blood.css" id="theme"/>

<link rel="stylesheet" href="./acm.css"/>
<link rel="stylesheet" href="file:///home/ironjanowar/reveal.js/lib/css/zenburn.css"/>
<!-- If the query includes 'print-pdf', include the PDF print sheet -->
<script>
    if( window.location.search.match( /print-pdf/gi ) ) {
        var link = document.createElement( 'link' );
        link.rel = 'stylesheet';
        link.type = 'text/css';
        link.href = 'file:///home/ironjanowar/reveal.js/css/print/pdf.css';
        document.getElementsByTagName( 'head' )[0].appendChild( link );
    }
</script>
<meta name="description" content="EmacsFTW.">
</head>
<body>
<div class="reveal">
<div class="slides">
<section id="sec-title-slide"><h1 class="title">Telegram Bots</h1><h2 class="author">@CesharPaste</h2><p class="date">Created: 2016-12-03 sáb 00:08</p>
</section>

<section>
<section id="slide-org9381b5e">
<h2 id="org9381b5e">Dafuq is a Telegram bot?</h2>

<div class="figure">
<p><img src="./data/dafuq_meme.jpg" alt="dafuq_meme.jpg" />
</p>
</div>


<p>
"<i><b>Bots</b> are simply Telegram accounts operated by software, <b>not people</b></i>"
</p>

</section>
</section>
<section>
<section id="slide-org9046186">
<h2 id="org9046186">Como funciona?</h2>

<div class="figure">
<p><img src="./data/yoqsetio.gif" alt="yoqsetio.gif" />
</p>
</div>
</section>
<section id="slide-org3406819">
<h3 id="org3406819">Que necesitas?</h3>
<ul>
<li>Python 3</li>
<li>pip 3</li>
<li>Un token de un bot</li>

</ul>
</section>
<section id="slide-orgbef9aec">
<h3 id="orgbef9aec">Token?</h3>
<p>
Yep, un TOKEN!
</p>

<p>
El cual nunca deberéis compartir ni subir a GitHub&#x2026;
</p>

<p>
El TOKEN nos lo dará @BotFather
</p>

</section>
</section>
<section>
<section id="slide-orga56a5d4">
<h2 id="orga56a5d4">Empecemos!</h2>
<p>
Instalar con vuestro gestor de paquetes:
</p>

<ul>
<li>python</li>
<li>python-pip</li>

</ul>

<p>
<b>Python 3</b> please!
</p>

</section>
<section id="slide-orgd3c7a95">
<h3 id="orgd3c7a95">Instalar la API</h3>
<p>
A mano:
</p>
<div class="org-src-container">

<pre><code class="bash" >$ git clone https://github.com/eternnoir/pyTelegramBotAPI.git
$ cd pyTelegramBotApi
$ python3 setup.py install
</code></pre>
</div>

</section>
<section id="slide-org7a9bfa8">
<h3 id="org7a9bfa8">Ahora a por el <b>TOKEN</b></h3>

<div class="figure">
<p><img src="./data/token1.jpg" alt="token1.jpg" />
</p>
</div>

</section>
<section id="slide-org098e31c">
<h3 id="org098e31c">Ya esta todo listo! Ahora a programar</h3>
<ul>
<li>Crear la carpeta donde vamos a hacer nuestro proyecto</li>

</ul>
<div class="org-src-container">

<pre><code class="bash" >$ mkdir MyBot
$ cd MyBot
</code></pre>
</div>

<ul>
<li>El archivo en el cual escribiremos nuestro código</li>

</ul>
<div class="org-src-container">

<pre><code class="bash" >$ touch bot.py
</code></pre>
</div>

</section>
<section id="slide-orga855974">
<h3 id="orga855974">Perooo&#x2026; Que escribo?</h3>
<ul>
<li>Lo primerísimo de todo, importar la librería</li>

</ul>

<div class="org-src-container">

<pre><code class="python" >import telebot
</code></pre>
</div>

<ul>
<li>Y crear el objeto <b>bot</b> con nuestro precioso <b>token</b></li>

</ul>

<div class="org-src-container">

<pre><code class="python" >bot = telebot.TeleBot("TOKEN")
</code></pre>
</div>

</section>
<section id="slide-orgcde48cc">
<h3 id="orgcde48cc">Handlers</h3>
<ul>
<li>Un handler es lo que va a permitir a tu bot saber cuándo le estás hablando</li>

</ul>

<div class="org-src-container">

<pre><code class="python" >@bot.message_handler(commands=['patata'])
def patata(message):
    # Lo que haga patata
</code></pre>
</div>

</section>
<section id="slide-org6d7acea">
<h3 id="org6d7acea">Ejemplo</h3>
<div class="org-src-container">

<pre><code class="python" >@bot.message_handler(commands=['hello'])
def hello(message):
    bot.reply_to(message, "Hello Telegram")
</code></pre>
</div>

<p>
La función <b>reply_ to</b> contesta al objeto <b>message</b>
</p>

</section>
<section id="slide-orgb68ed62">
<h3 id="orgb68ed62">Well done</h3>
<p>
Ahora falta el <b>long polling</b>, que básicamente es que el bot le pregunte al servidor si hay algo para él (Muy muy resumidamente)
</p>

<p>
Para ello haremos lo siguiente:
</p>

<div class="org-src-container">

<pre><code class="python" >bot.polling()
</code></pre>
</div>

</section>
<section id="slide-org7b53a79">
<h3 id="org7b53a79">TIP</h3>
<p>
Al ejecutar nuestro bot puede dar la sensación de que se ha quedado colgado
</p>

<p>
Para sacarnos de dudas podemos poner un <b>print</b> cuando hagamos el polling
</p>

<p>
Tal que así:
</p>
<div class="org-src-container">

<pre><code class="python" >print("Running...")
bot.polling()
</code></pre>
</div>

</section>
<section id="slide-org5eaedf7">
<h3 id="org5eaedf7">Ejemplo completo</h3>
<div class="org-src-container">

<pre><code class="python" >import telebot

bot = telebot.TeleBot("9823982:aeoEOHtejhonHJeojhoEUoEUotaToIPC")

@bot.message_handler(commands=['hello'])
def hello(message):
    bot.reply_to(message, "Hello Telegram")

print("Running...")
bot.polling()
</code></pre>
</div>

</section>
<section id="slide-orgf61a3c9">
<h3 id="orgf61a3c9">TIP 2</h3>
<p>
Documentar vuestro código, es de muuuuuuuuucha ayuda
</p>

<div class="org-src-container">

<pre><code class="python" >import telebot

# Creamos el bot
bot = telebot.TeleBot("9823982:aeoEOHtejhonHJeojhoEUoEUotaToIPC")

# Handlers
@bot.message_handler(commands=['hello'])
def hello(message):
    # Envia un mensaje al recibir /hello
    bot.reply_to(message, "Hello Telegram")

# Iniciamos el polling
print("Running...")
bot.polling()
</code></pre>
</div>

</section>
</section>
<section>
<section id="slide-org74ab87f">
<h2 id="org74ab87f">Ahora a probarlo!</h2>
<p>
En una terminal vamos al directorio del bot y escribimos:
</p>

<div class="org-src-container">

<pre><code class="bash" >$ python bot.py
</code></pre>
</div>

<p>
El resultado es el siguiente:
</p>


<div class="figure">
<p><img src="./data/running_bot.jpg" alt="running_bot.jpg" />
</p>
</div>

</section>
<section id="slide-org8c213d3">
<h3 id="org8c213d3">Nuestro bot ya está funcionando!</h3>

<div class="figure">
<p><img src="./data/testing_bot.jpg" alt="testing_bot.jpg" />
</p>
</div>

</section>
</section>
<section>
<section id="slide-orga71edea">
<h2 id="orga71edea">Predicción de comandos en BotFather</h2>
<p>
Esto se hace desde Telegram!
</p>
</section>
</section>
<section>
<section id="slide-orga431652">
<h2 id="orga431652">Funciones que puede hacer el bot</h2>
<dl>
<dt>reply_ to</dt><dd><i>Contesta a un mensaje</i></dd>
<dt>send_ message</dt><dd><i>Envía un mensaje al chat que le indiquemos</i></dd>
<dt>send_ photo</dt><dd><i>Envía una foto al chat que le indiquemos</i></dd>
<dt>send_ audio</dt><dd><i>Envía un audio al chat que le indiquemos</i></dd>

</dl>

<p>
Y muchas más&#x2026;
</p>

<p>
<a href="https://core.telegram.org/bots/api#available-methods">https://core.telegram.org/bots/api#available-methods</a>
</p>
</section>
</section>
<section>
<section id="slide-org1e61964">
<h2 id="org1e61964">Inline bots</h2>
<p>
Peroo&#x2026; HAY MÁS!?
</p>


<div class="figure">
<p><img src="./data/wtf.gif" alt="wtf.gif" />
</p>
</div>

</section>
<section id="slide-orgb106cd7">
<h3 id="orgb106cd7">Of course!</h3>
<p>
<b>@gif</b> es un bot inline.
</p>

<p>
Puedes "hablar" con el desde cualquier chat aunque no esté en él.
</p>


<div class="figure">
<p><img src="./data/gif_bot.gif" alt="gif_bot.gif" />
</p>
</div>

</section>
<section id="slide-org7a730b4">
<h3 id="org7a730b4">Como lo iso!!</h3>
<p>
Con <b>inline handler</b>
</p>


<div class="figure">
<p><img src="./data/magic.gif" alt="magic.gif" />
</p>
</div>

</section>
<section id="slide-org1eca4bc">
<h3 id="org1eca4bc">Inline Handler</h3>
<div class="org-src-container">

<pre><code class="python" >@bot.inline_handler(lambda query: ... )
def inline_function(query):
    # Inline function
</code></pre>
</div>
</section>
<section id="slide-orgdbd10e2">
<h3 id="orgdbd10e2">OMG lambda functions</h3>
<p>
No es para tanto
</p>
</section>
<section id="slide-org6248b8e">
<h3 id="org6248b8e">Lambda functions en Python</h3>
<p>
Es una función anónima que nos permite hacer lo siguiente.
</p>

<div class="org-src-container">

<pre><code class="python" >&gt;&gt;&gt; g = lambda x: x**2
&gt;&gt;&gt; g(3)
9
</code></pre>
</div>

<p>
En vez de esto:
</p>

<div class="org-src-container">

<pre><code class="python" >&gt;&gt;&gt; def al_cuadrado(x):
...     return x**2
&gt;&gt;&gt; al_cuadrado(3)
9
</code></pre>
</div>
</section>
<section id="slide-orgccd45d7">
<h3 id="orgccd45d7">Ventajas</h3>

<div class="figure">
<p><img src="./data/yoqsetio.gif" alt="yoqsetio.gif" />
</p>
</div>
</section>
<section id="slide-orgbc51559">
<h3 id="orgbc51559">Lo que nos interesa</h3>
<p>
Usarla como trigger para nuestras funciones
</p>
<div class="org-src-container">

<pre><code class="python" >@bot.inline_handler(lambda query: condición )
def inline_function(inline_query):
    # Inline function
</code></pre>
</div>

<p>
En este caso si escriben <b>@awesome_ name_ for_ a_ bot hola</b>:
</p>
<div class="org-src-container">

<pre><code class="python" >@bot.inline_handler(lambda query: query.query == "hola")
def inline_function(inline_query):
    # Inline function
</code></pre>
</div>

<p>
<i>Aunque también nos valen funciones normales, las <b>lambda</b> suelen ser más cómodas</i>
</p>

</section>
<section id="slide-org99845e8">
<h3 id="org99845e8">Ahora cambia la cosa</h3>
<div class="org-src-container">

<pre><code class="python" >resultado = types.InlineQueryResultArticle(ID, Titulo, AEnviar)
</code></pre>
</div>

<dl>
<dt>ID</dt><dd>Identificador del resultado</dd>
<dt>Título</dt><dd>Título de la función que va a hacer el bot</dd>
<dt>A enviar</dt><dd>Lo que enviará el bot al chat</dd>

</dl>
</section>
<section id="slide-orga1e56a3">
<h3 id="orga1e56a3">Aquí se ve mejor</h3>

<div class="figure">
<p><img src="./data/inline_list.jpg" alt="inline_list.jpg" />
</p>
</div>


<div class="figure">
<p><img src="./data/inline_respuesta.jpg" alt="inline_respuesta.jpg" />
</p>
</div>
</section>
<section id="slide-orgb0ae7a0">
<h3 id="orgb0ae7a0">Le decimos al bot lo que tiene que enviar</h3>
<div class="org-src-container">

<pre><code class="python" >bot.answer_inline_query(donde, [que])
</code></pre>
</div>

<dl>
<dt>donde</dt><dd>A donde lo enviamos</dd>
<dt>que</dt><dd>Qué enviamos</dd>

</dl>
</section>
<section id="slide-org70ffd25">
<h3 id="org70ffd25">Ejemplo</h3>
<div class="org-src-container">

<pre><code class="python" >bot.answer_inline_query(inline_query.id, [r])
</code></pre>
</div>
</section>
<section id="slide-orgf438f6a">
<h3 id="orgf438f6a">Ejemplo completo</h3>
<div class="org-src-container">

<pre><code class="python" >@bot.inline_handler(lambda query: query.query == "hola")
def hola(inline_query):
    r = types.InlineQueryResultArticle('1', 'Saludo', types.InputTextMessageContent("Well hello!"))
    bot.answer_inline_query(inline_query.id, [r])
</code></pre>
</div>

<p>
Lo que nos sale para dar click
</p>
<pre class="example">
</pre>

<div class="figure">
<p><img src="./data/inline_saludo1.jpg" alt="inline_saludo1.jpg" /> 
</p>
</div>

<p>
Lo que contesta el bot:
</p>


<div class="figure">
<p><img src="./data/inline_saludo2.jpg" alt="inline_saludo2.jpg" />
</p>
</div>
</section>
<section id="slide-orgaa9b7fe">
<h3 id="orgaa9b7fe">Ejemplo completo</h3>
<div class="org-src-container">

<pre><code class="python" >import telebot
from telebot import types

# Creamos el bot
bot = telebot.TeleBot("201337136:AAHc5lIPPqAFqAcX6bNMTNV2pFTzlbzsJtI")


@bot.inline_handler(lambda query: query.query == "hola")
def hola(inline_query):
    # Envia Well Hello
    r = types.InlineQueryResultArticle('1', 'Saludo', types.InputTextMessageContent("Well hello!"))
    bot.answer_inline_query(inline_query.id, [r])

# Iniciamos el bot
print("Running...")
bot.polling()
</code></pre>
</div>
</section>
<section id="slide-org5cba4b1">
<h3 id="org5cba4b1">Permitir inline</h3>
<p>
Una vez más acudiremos a BotFather
</p>


<div class="figure">
<p><img src="./data/set_inline.jpg" alt="set_inline.jpg" />
</p>
</div>
</section>
</section>
<section>
<section id="slide-orgcd15fa2">
<h2 id="orgcd15fa2">De donde puedo aprender cosas?</h2>
<p>
La API está bastante bien documentada con los ejemplos
</p>

<p>
<a href="https://github.com/eternnoir/pyTelegramBotAPI/tree/master/examples">https://github.com/eternnoir/pyTelegramBotAPI/tree/master/examples</a>
</p>

</section>
<section id="slide-org15aada2">
<h3 id="org15aada2">Ejemplos que encontréis por ahí</h3>
<ul>
<li>El bot de ACM</li>

</ul>
<p>
<a href="https://github.com/acmfi/ACMbot/tree/dev">https://github.com/acmfi/ACMbot/tree/dev</a>
</p>

<ul>
<li>Bots propios</li>

</ul>
<p>
<a href="https://github.com/Ironjanowar/SaveLinksBot">https://github.com/Ironjanowar/SaveLinksBot</a>
</p>

<p>
<a href="https://github.com/Ironjanowar/TheConvertorBot/">https://github.com/Ironjanowar/TheConvertorBot/</a> ← Inline
</p>
</section>
</section>
</div>
</div>
<script src="file:///home/ironjanowar/reveal.js/lib/js/head.min.js"></script>
<script src="file:///home/ironjanowar/reveal.js/js/reveal.js"></script>

<script>
// Full list of configuration options available here:
// https://github.com/hakimel/reveal.js#configuration
Reveal.initialize({

controls: true,
progress: true,
history: true,
center: true,
slideNumber: 'h/v',
rollingLinks: false,
keyboard: true,
overview: true,
width: 1200,
height: 800,
margin: 0.10,
minScale: 0.50,
maxScale: 2.50,

theme: Reveal.getQueryHash().theme, // available themes are in /css/theme
transition: Reveal.getQueryHash().transition || 'linear', // default/cube/page/concave/zoom/linear/fade/none
transitionSpeed: 'default',
multiplex: {
    secret: '', // null if client
    id: '', // id, obtained from socket.io server
    url: '' // Location of socket.io server
},

// Optional libraries used to extend on reveal.js
dependencies: [
 { src: 'file:///home/ironjanowar/reveal.js/plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
 { src: 'file:///home/ironjanowar/reveal.js/plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
 { src: 'file:///home/ironjanowar/reveal.js/plugin/notes/notes.js', async: true, condition: function() { return !!document.body.classList; } },
 { src: 'file:///home/ironjanowar/reveal.js/plugin/zoom-js/zoom.js', async: true, condition: function() { return !!document.body.classList; } },
 { src: '', async: true },
 { src: 'file:///home/ironjanowar/reveal.js/plugin/multiplex/master.js', async: true },
 { src: 'file:///home/ironjanowar/reveal.js/lib/js/classList.js', condition: function() { return !document.body.classList; } },
 { src: 'file:///home/ironjanowar/reveal.js/plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } }]
});
</script>
</body>
</html>
